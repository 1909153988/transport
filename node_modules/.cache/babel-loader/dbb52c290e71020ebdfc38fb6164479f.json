{"remainingRequest":"D:\\项目\\jusheng1\\node_modules\\babel-loader\\lib\\index.js!D:\\项目\\jusheng1\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\项目\\jusheng1\\src\\permission.js","dependencies":[{"path":"D:\\项目\\jusheng1\\src\\permission.js","mtime":1627990493650},{"path":"D:\\项目\\jusheng1\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\项目\\jusheng1\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\项目\\jusheng1\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCJEOi9cdTk4NzlcdTc2RUUvanVzaGVuZzEvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvaW50ZXJvcFJlcXVpcmVEZWZhdWx0IikuZGVmYXVsdDsKCnZhciBfb2JqZWN0U3ByZWFkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiRDovXHU5ODc5XHU3NkVFL2p1c2hlbmcxL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL29iamVjdFNwcmVhZDIiKSk7Cgp2YXIgX3JvdXRlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiLi9yb3V0ZXIiKSk7Cgp2YXIgX3N0b3JlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCIuL3N0b3JlIikpOwoKdmFyIF9lbGVtZW50VWkgPSByZXF1aXJlKCJlbGVtZW50LXVpIik7Cgp2YXIgX25wcm9ncmVzcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgibnByb2dyZXNzIikpOwoKcmVxdWlyZSgibnByb2dyZXNzL25wcm9ncmVzcy5jc3MiKTsKCnZhciBfYXV0aCA9IHJlcXVpcmUoIkAvdXRpbHMvYXV0aCIpOwoKX25wcm9ncmVzcy5kZWZhdWx0LmNvbmZpZ3VyZSh7CiAgc2hvd1NwaW5uZXI6IGZhbHNlCn0pOwoKdmFyIHdoaXRlTGlzdCA9IFsiL2xvZ2luIiwgIi9hdXRoLXJlZGlyZWN0IiwgIi9iaW5kIiwgIi9lZGl0QWNjb3VudHMiLCAiL2FkZG9yZGVyIiwgIi9yZWdpc3RlcnN1Y2Nlc3NmdWwiLCAiL2xpc3QiLCAiL3JlZyJdOwoKX3JvdXRlci5kZWZhdWx0LmJlZm9yZUVhY2goZnVuY3Rpb24gKHRvLCBmcm9tLCBuZXh0KSB7CiAgX25wcm9ncmVzcy5kZWZhdWx0LnN0YXJ0KCk7CgogIGlmICgoMCwgX2F1dGguZ2V0VG9rZW4pKCkpIHsKICAgIC8qIGhhcyB0b2tlbiovCiAgICBpZiAodG8ucGF0aCA9PT0gIi9sb2dpbiIpIHsKICAgICAgbmV4dCh7CiAgICAgICAgcGF0aDogIi8iCiAgICAgIH0pOwoKICAgICAgX25wcm9ncmVzcy5kZWZhdWx0LmRvbmUoKTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChfc3RvcmUuZGVmYXVsdC5nZXR0ZXJzLnJvbGVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIC8vIOWIpOaWreW9k+WJjeeUqOaIt+aYr+WQpuW3suaLieWPluWujHVzZXJfaW5mb+S/oeaBrwogICAgICAgIF9zdG9yZS5kZWZhdWx0LmRpc3BhdGNoKCJHZXRJbmZvIikudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfc3RvcmUuZGVmYXVsdC5kaXNwYXRjaCgiR2VuZXJhdGVSb3V0ZXMiKS50aGVuKGZ1bmN0aW9uIChhY2Nlc3NSb3V0ZXMpIHsKICAgICAgICAgICAgLy8g5qC55o2ucm9sZXPmnYPpmZDnlJ/miJDlj6/orr/pl67nmoTot6/nlLHooagKICAgICAgICAgICAgX3JvdXRlci5kZWZhdWx0LmFkZFJvdXRlcyhhY2Nlc3NSb3V0ZXMpOyAvLyDliqjmgIHmt7vliqDlj6/orr/pl67ot6/nlLHooagKCgogICAgICAgICAgICBuZXh0KCgwLCBfb2JqZWN0U3ByZWFkMi5kZWZhdWx0KSgoMCwgX29iamVjdFNwcmVhZDIuZGVmYXVsdCkoe30sIHRvKSwge30sIHsKICAgICAgICAgICAgICByZXBsYWNlOiB0cnVlCiAgICAgICAgICAgIH0pKTsgLy8gaGFja+aWueazlSDnoa7kv51hZGRSb3V0ZXPlt7LlrozmiJAKICAgICAgICAgIH0pOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgIF9zdG9yZS5kZWZhdWx0LmRpc3BhdGNoKCJMb2dPdXQiKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX2VsZW1lbnRVaS5NZXNzYWdlLmVycm9yKGVycik7CgogICAgICAgICAgICBuZXh0KHsKICAgICAgICAgICAgICBwYXRoOiAiLyIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBuZXh0KCk7CiAgICAgIH0KICAgIH0KICB9IGVsc2UgewogICAgLy8g5rKh5pyJdG9rZW4KICAgIGlmICh3aGl0ZUxpc3QuaW5kZXhPZih0by5wYXRoKSAhPT0gLTEpIHsKICAgICAgLy8g5Zyo5YWN55m75b2V55m95ZCN5Y2V77yM55u05o6l6L+b5YWlCiAgICAgIG5leHQoKTsKICAgIH0gZWxzZSB7CiAgICAgIG5leHQoIi9sb2dpbj9yZWRpcmVjdD0iLmNvbmNhdCh0by5mdWxsUGF0aCkpOyAvLyDlkKbliJnlhajpg6jph43lrprlkJHliLDnmbvlvZXpobUKCiAgICAgIF9ucHJvZ3Jlc3MuZGVmYXVsdC5kb25lKCk7CiAgICB9CiAgfQp9KTsKCl9yb3V0ZXIuZGVmYXVsdC5hZnRlckVhY2goZnVuY3Rpb24gKCkgewogIF9ucHJvZ3Jlc3MuZGVmYXVsdC5kb25lKCk7Cn0pOw=="},{"version":3,"sources":["D:/项目/jusheng1/src/permission.js"],"names":["NProgress","configure","showSpinner","whiteList","router","beforeEach","to","from","next","start","path","done","store","getters","roles","length","dispatch","then","accessRoutes","addRoutes","replace","catch","err","Message","error","indexOf","fullPath","afterEach"],"mappings":";;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEAA,mBAAUC,SAAV,CAAoB;AAAEC,EAAAA,WAAW,EAAE;AAAf,CAApB;;AAEA,IAAMC,SAAS,GAAG,CACd,QADc,EAEd,gBAFc,EAGd,OAHc,EAId,eAJc,EAKd,WALc,EAMd,qBANc,EAOd,OAPc,EAQd,MARc,CAAlB;;AAWAC,gBAAOC,UAAP,CAAkB,UAACC,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAoB;AAClCR,qBAAUS,KAAV;;AACA,MAAI,qBAAJ,EAAgB;AACZ;AACA,QAAIH,EAAE,CAACI,IAAH,KAAY,QAAhB,EAA0B;AACtBF,MAAAA,IAAI,CAAC;AAAEE,QAAAA,IAAI,EAAE;AAAR,OAAD,CAAJ;;AACAV,yBAAUW,IAAV;AACH,KAHD,MAGO;AACH,UAAIC,eAAMC,OAAN,CAAcC,KAAd,CAAoBC,MAApB,KAA+B,CAAnC,EAAsC;AAClC;AACAH,uBACKI,QADL,CACc,SADd,EAEKC,IAFL,CAEU,YAAM;AACRL,yBAAMI,QAAN,CAAe,gBAAf,EAAiCC,IAAjC,CAAsC,UAAAC,YAAY,EAAI;AAClD;AACAd,4BAAOe,SAAP,CAAiBD,YAAjB,EAFkD,CAElB;;;AAChCV,YAAAA,IAAI,6DAAKF,EAAL;AAASc,cAAAA,OAAO,EAAE;AAAlB,eAAJ,CAHkD,CAGnB;AAClC,WAJD;AAKH,SARL,EASKC,KATL,CASW,UAAAC,GAAG,EAAI;AACVV,yBAAMI,QAAN,CAAe,QAAf,EAAyBC,IAAzB,CAA8B,YAAM;AAChCM,+BAAQC,KAAR,CAAcF,GAAd;;AACAd,YAAAA,IAAI,CAAC;AAAEE,cAAAA,IAAI,EAAE;AAAR,aAAD,CAAJ;AACH,WAHD;AAIH,SAdL;AAeH,OAjBD,MAiBO;AACHF,QAAAA,IAAI;AACP;AACJ;AACJ,GA3BD,MA2BO;AACH;AACA,QAAIL,SAAS,CAACsB,OAAV,CAAkBnB,EAAE,CAACI,IAArB,MAA+B,CAAC,CAApC,EAAuC;AACnC;AACAF,MAAAA,IAAI;AACP,KAHD,MAGO;AACHA,MAAAA,IAAI,2BAAoBF,EAAE,CAACoB,QAAvB,EAAJ,CADG,CACqC;;AACxC1B,yBAAUW,IAAV;AACH;AACJ;AACJ,CAvCD;;AAyCAP,gBAAOuB,SAAP,CAAiB,YAAM;AACnB3B,qBAAUW,IAAV;AACH,CAFD","sourcesContent":["import router from \"./router\";\r\nimport store from \"./store\";\r\nimport { Message } from \"element-ui\";\r\nimport NProgress from \"nprogress\";\r\nimport \"nprogress/nprogress.css\";\r\nimport { getToken } from \"@/utils/auth\";\r\n\r\nNProgress.configure({ showSpinner: false });\r\n\r\nconst whiteList = [\r\n    \"/login\",\r\n    \"/auth-redirect\",\r\n    \"/bind\",\r\n    \"/editAccounts\",\r\n    \"/addorder\",\r\n    \"/registersuccessful\",\r\n    \"/list\",\r\n    \"/reg\",\r\n];\r\n\r\nrouter.beforeEach((to, from, next) => {\r\n    NProgress.start();\r\n    if (getToken()) {\r\n        /* has token*/\r\n        if (to.path === \"/login\") {\r\n            next({ path: \"/\" });\r\n            NProgress.done();\r\n        } else {\r\n            if (store.getters.roles.length === 0) {\r\n                // 判断当前用户是否已拉取完user_info信息\r\n                store\r\n                    .dispatch(\"GetInfo\")\r\n                    .then(() => {\r\n                        store.dispatch(\"GenerateRoutes\").then(accessRoutes => {\r\n                            // 根据roles权限生成可访问的路由表\r\n                            router.addRoutes(accessRoutes); // 动态添加可访问路由表\r\n                            next({...to, replace: true }); // hack方法 确保addRoutes已完成\r\n                        });\r\n                    })\r\n                    .catch(err => {\r\n                        store.dispatch(\"LogOut\").then(() => {\r\n                            Message.error(err);\r\n                            next({ path: \"/\" });\r\n                        });\r\n                    });\r\n            } else {\r\n                next();\r\n            }\r\n        }\r\n    } else {\r\n        // 没有token\r\n        if (whiteList.indexOf(to.path) !== -1) {\r\n            // 在免登录白名单，直接进入\r\n            next();\r\n        } else {\r\n            next(`/login?redirect=${to.fullPath}`); // 否则全部重定向到登录页\r\n            NProgress.done();\r\n        }\r\n    }\r\n});\r\n\r\nrouter.afterEach(() => {\r\n    NProgress.done();\r\n});\r\n"]}]}